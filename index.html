<!--
DROP-IN UPDATE
1) Replace your <select id="gradeFilter"> options with the updated block below.
2) Replace your <select id="pillarFilter"> options with the updated block below.
3) Replace your PROGRAMS constant with the expanded PROGRAMS below.
4) Replace your COST_CONFIG with the updated version below (adds All Ages + a simple guard).
5) Replace your calculateCost() and recalc() with the updated versions below (handles non-bookable resources/exhibits cleanly).
-->

<!-- 1) Updated Grade Filter (add All Ages) -->
<select id="gradeFilter" class="filter-select">
  <option value="">All grade bands</option>
  <option value="All Ages">All Ages</option>
  <option value="PreK-2">PreK–2</option>
  <option value="3-5">Grades 3–5</option>
  <option value="6-8">Grades 6–8</option>
  <option value="8-10">Grades 8–10</option>
  <option value="10-12">Grades 10–12</option>
  <option value="Adult">Adult</option>
</select>

<!-- 2) Updated Pillar Filter (add ESI + “Foundation/Partner/Public” lanes) -->
<select id="pillarFilter" class="filter-select">
  <option value="">All categories</option>
  <option value="ELI">K–12 Education (ELI)</option>
  <option value="EAN">Community Engagement (EAN)</option>
  <option value="ESI">Visitor Center & Stewardship (ESI)</option>
  <option value="Foundation">Foundation Series</option>
  <option value="Partner">Partner Series</option>
</select>

<script>
/* 3) Expanded PROGRAMS
   Notes on mapping:
   - K–12 / camps / kits / field trips = ELI
   - Community programs, volunteer training, public tours = EAN (and Foundation/Partner where relevant)
   - Visitor-center experiences and access programming = ESI
   - Some items are resources/exhibits; those set costEligible:false so the estimator clearly shows N/A
*/
const PROGRAMS = [
  /* --- SoundPath / EEP programs you already had --- */
  {
    id: "sound-sprouts",
    name: "Sound Sprouts",
    gradeBand: "PreK-2",
    pillar: "ELI",
    series: "SoundPath",
    standards: "Foundational NGSS, SEL early childhood",
    sessions: ["Bring the Outside In"],
    formats: ["2-3 hours"],
    gradeLabel: "Infant–PreK with caregiver only",
    shortDescription: "Indoor playful, sensory-based estuary exploration for caregivers and young children.",
    costEligible: true,
  },
  {
    id: "little-sound-scouts",
    name: "Little Sound Scouts",
    gradeBand: "PreK-2",
    pillar: "ELI",
    series: "SoundPath",
    standards: "NGSS K-ESS2-1, K-LS1-1; SEL",
    sessions: ["10-week: Seasons Around the Sound", "4-week: Small Scientists by the Shore", "5-day camp: My Estuary Adventure", "1-day: Little Beachcombers"],
    formats: ["10-week", "4-week", "5-day camp", "1-day field trip"],
    gradeLabel: "Grades K–2",
    shortDescription: "Early elementary nature adventures focusing on observation, wonder, and estuary exploration.",
    costEligible: true,
  },
  {
    id: "sound-detectives",
    name: "Sound Detectives",
    gradeBand: "3-5",
    pillar: "ELI",
    series: "SoundPath",
    standards: "NGSS 3-LS4-3, 4-ESS2-2, 5-PS1-3",
    sessions: ["10-week: Unlocking Estuary Mysteries", "4-week: Intro to Investigation", "5-day camp: Shifting Shoreline", "1-day: Junior Investigator"],
    formats: ["10-week", "4-week", "5-day camp", "1-day field trip"],
    gradeLabel: "Grades 2–5 / 3–5 focus",
    shortDescription: "Inquiry-based field science where students collect data, map habitats, and solve estuary mysteries.",
    costEligible: true,
  },
  {
    id: "eco-navigators",
    name: "Eco Navigators",
    gradeBand: "6-8",
    pillar: "ELI",
    series: "SoundPath",
    standards: "Middle school NGSS (LS2.A, ESS3.C)",
    sessions: ["10-week: Unlocking Estuary Mysteries", "4-week: Four-Way Compass", "5-day camp: Estuary Action Lab"],
    formats: ["10-week", "4-week", "5-day camp", "1-day field trip"],
    gradeLabel: "Grades 6–8",
    shortDescription: "Middle school field program using navigation, mapping, and stewardship projects.",
    costEligible: true,
  },
  {
    id: "echo-sounders",
    name: "Echo Sounders",
    gradeBand: "8-10",
    pillar: "ELI",
    series: "SoundPath",
    standards: "MS-LS2-2, MS-LS2-5, MS-ESS3-3",
    sessions: ["10-week: Science for Belonging", "4-week: Field Science Foundations", "5-day camp: Echoes from the Shore", "1-day: Science Belongs to You"],
    formats: ["10-week", "4-week", "5-day camp", "1-day intensive"],
    gradeLabel: "Grades 8–10",
    shortDescription: "Field science that builds teamwork, research skills, and leadership readiness.",
    costEligible: true,
  },
  {
    id: "sound-quest",
    name: "SoundQuest",
    gradeBand: "8-10",
    pillar: "ELI",
    series: "SoundPath",
    standards: "MS-LS2-1, MS-LS2-5, MS-ESS3-3",
    sessions: ["10-week: Queer Ecology in Action", "4-week: Estuary, Identity, and Action", "5-day camp: Field Science for Queer Belonging", "1-day: Estuary Identity intensive"],
    formats: ["10-week", "4-week", "5-day camp", "1-day intensive"],
    gradeLabel: "Grades 8–12 and LGBTQIA youth",
    shortDescription: "Queer-inclusive estuary program combining field science, arts, and identity-affirming leadership.",
    costEligible: true,
  },
  {
    id: "sound-scholars",
    name: "Sound Scholars",
    gradeBand: "10-12",
    pillar: "ELI",
    series: "SoundPath",
    standards: "HS-LS2-6, HS-ESS3-4, HS-ETS1-3",
    sessions: ["10-week: Leadership Through Estuary Science", "4-week: Youth Science in Action", "5-day camp: Science, Stewardship, and Story", "1-day: Lead Like a Scientist"],
    formats: ["10-week", "4-week", "5-day camp", "1-day intensive"],
    gradeLabel: "Grades 10–12",
    shortDescription: "Advanced high school field research, science communication, and youth leadership.",
    costEligible: true,
  },
  {
    id: "sound-trekkers",
    name: "Sound Trekkers",
    gradeBand: "Adult",
    pillar: "EAN",
    series: "SoundPath",
    standards: "Adult field science and stewardship learning",
    sessions: ["10-week: Knowing the Sound, Caring for the Sound", "4-week: Estuary Essentials", "5-day: Field Science for Everyday People", "1-day: Walk the Estuary"],
    formats: ["10-week", "4-week", "5-day mini course", "1-day intensive"],
    gradeLabel: "Adults 18+",
    shortDescription: "Immersive adult field program for aspiring naturalists and community stewards.",
    costEligible: true,
  },
  {
    id: "our-sound-selves",
    name: "Our Sound Selves",
    gradeBand: "Adult",
    pillar: "ESI",
    series: "SoundPath",
    standards: "Ecological literacy + reflective learning",
    sessions: ["10-week: The Estuary Within", "4-week: Reflections in the Water", "5-day: Echoes of the Estuary", "1-day: The Sound Within"],
    formats: ["10-week", "4-week", "5-day mini course", "1-day workshop"],
    gradeLabel: "Adults 18+",
    shortDescription: "Estuary learning that connects science, personal reflection, and stewardship.",
    costEligible: true,
  },

  /* --- Programs found on pugetsoundestuarium.org --- */

  /* K–12 / Education (ELI) */
  {
    id: "field-trips-prek-12",
    name: "Field Trips (PreK–12)",
    gradeBand: "All Ages",
    pillar: "ELI",
    series: "ELI",
    standards: "NGSS-aligned place-based learning",
    sessions: ["Custom field trip modules by grade band"],
    formats: ["Field trip", "On-site", "Off-site"],
    gradeLabel: "PreK–12",
    shortDescription: "School field experiences connecting students to Puget Sound estuaries through hands-on learning.",
    costEligible: true,
  },
  {
    id: "school-estuary-kits",
    name: "School Estuary Kits (Checkout & Purchase)",
    gradeBand: "All Ages",
    pillar: "ELI",
    series: "ELI",
    standards: "Classroom-ready estuary science resources",
    sessions: ["Kit checkout: multiple estuary themes"],
    formats: ["Curriculum kit", "Classroom"],
    gradeLabel: "K–12 (kit-based)",
    shortDescription: "Estuary-themed classroom kits available for checkout to support teacher-led learning. Use form to purchase.",
    costEligible: false, // often free/loaner; keep estimator from implying pricing
  },
  {
    id: "bayshore-fieldstem",
    name: "Bayshore FieldSTEM",
    gradeBand: "6-8",
    pillar: "ELI",
    series: "Partner",
    standards: "FieldSTEM model; NGSS-aligned",
    sessions: ["Field-based STEM learning at Bayshore Preserve"],
    formats: ["Field program", "Partner site"],
    gradeLabel: "7th grade focus",
    shortDescription: "Outdoor STEM learning at Bayshore Preserve using a FieldSTEM approach.",
    costEligible: true,
  },
  {
    id: "estuary-life-landforms",
    name: "Estuary Life & Landforms (ELL)",
    gradeBand: "3-5",
    pillar: "ELI",
    series: "ELI",
    standards: "Place-based estuary science (virtual/in-classroom)",
    sessions: ["Virtual learning experience (program module)"],
    formats: ["Virtual", "On-campus"],
    gradeLabel: "5th grade focus",
    shortDescription: "Virtual or on-campus learning about Budd Inlet, estuary habitats, and landforms.",
    costEligible: true,
  },
  {
    id: "estuary-explorers-summer-camp",
    name: "Estuary Explorers Summer Camp",
    gradeBand: "3-5",
    pillar: "ELI",
    series: "Foundation",
    standards: "Hands-on marine and estuary science",
    sessions: ["Summer camp sessions (seasonal)"],
    formats: ["Camp", "Multi-day"],
    gradeLabel: "Grades 2–8",
    shortDescription: "Hands-on summer camp focused on estuary exploration, discovery, and field science.",
    costEligible: true,
  },
  {
    id: "estuary-investigation-camps",
    name: "Estuary Investigation Camps",
    gradeBand: "8-12",
    pillar: "ELI",
    series: "Foundation",
    standards: "Field investigation and applied ecology",
    sessions: ["Seasonal investigation camps (multi-day)"],
    formats: ["Camp", "Multi-day"],
    gradeLabel: "Grades 8–12",
    shortDescription: "Multi-day investigation camps for older youth featuring deeper field science and inquiry.",
    costEligible: true,
  },

  /* Community Programs (EAN, Foundation/Partner Series) */
  {
    id: "pier-peer",
    name: "Pier Peer",
    gradeBand: "All Ages",
    pillar: "EAN",
    series: "Foundation",
    standards: "Community science and species ID",
    sessions: ["Nighttime pier exploration (event)"],
    formats: ["Public event", "Night program"],
    gradeLabel: "All ages (youth and adult ticketing)",
    shortDescription: "Nighttime dockside exploration using underwater lights to discover estuary creatures with staff guidance.",
    costEligible: true,
  },
  {
    id: "meet-the-beach",
    name: "Meet the Beach",
    gradeBand: "All Ages",
    pillar: "EAN",
    series: "Foundation",
    standards: "Intertidal ecology and community learning",
    sessions: ["Low-tide shoreline exploration (seasonal series)"],
    formats: ["Public program", "Low tide", "Volunteer-supported"],
    gradeLabel: "All ages",
    shortDescription: "Low-tide shoreline program supported by trained Beach Naturalists for species ID and intertidal discovery.",
    costEligible: true,
  },
  {
    id: "beach-naturalist-training",
    name: "Beach Naturalist Training",
    gradeBand: "Adult",
    pillar: "EAN",
    series: "Foundation",
    standards: "Volunteer training for shoreline interpretation",
    sessions: ["Training sessions (webinar and/or field learning)"],
    formats: ["Training", "Volunteer"],
    gradeLabel: "Adults (volunteers)",
    shortDescription: "Training program preparing volunteers to support Meet the Beach with interpretive and ID skills.",
    costEligible: false,
  },
  {
    id: "downtown-tours",
    name: "Downtown Tours",
    gradeBand: "All Ages",
    pillar: "EAN",
    series: "Foundation",
    standards: "Urban ecology and shoreline interpretation",
    sessions: ["Urban Birding", "Sea Stroll (historic shoreline tour)"],
    formats: ["Guided tour", "Public program"],
    gradeLabel: "All ages",
    shortDescription: "Guided tours in downtown Olympia including urban birding and shoreline-focused Sea Stroll experiences.",
    costEligible: true,
  },
  {
    id: "urban-birding",
    name: "Urban Birding",
    gradeBand: "All Ages",
    pillar: "EAN",
    series: "Partner",
    standards: "Bird identification and urban habitat learning",
    sessions: ["Guided birding tour (event)"],
    formats: ["Guided tour", "Public program"],
    gradeLabel: "All ages",
    shortDescription: "Guided urban birding tour highlighting local species and habitat connections.",
    costEligible: true,
  },
  {
    id: "sea-stroll",
    name: "Sea Stroll (Historic Shoreline Tours)",
    gradeBand: "All Ages",
    pillar: "EAN",
    series: "Partner",
    standards: "Shoreline change, history, and place-based learning",
    sessions: ["Guided shoreline tour (event)"],
    formats: ["Guided tour", "Public program"],
    gradeLabel: "All ages",
    shortDescription: "Guided shoreline walks connecting local history with estuary ecology.",
    costEligible: true,
  },
  {
    id: "discovery-speaker-series",
    name: "Discovery Speaker Series",
    gradeBand: "Adult",
    pillar: "EAN",
    series: "Foundation",
    standards: "Public learning: science, restoration, stewardship",
    sessions: ["Talks with scientists, educators, artists, and advocates"],
    formats: ["Lecture", "Community event"],
    gradeLabel: "Adult-leaning (open to all)",
    shortDescription: "Free public talks featuring local research, restoration, and community learning.",
    costEligible: false,
  },
  {
    id: "private-events",
    name: "Private Events (Program Bookings)",
    gradeBand: "All Ages",
    pillar: "EAN",
    series: "Foundation",
    standards: "Custom program delivery for groups",
    sessions: ["Private booking options for select programs"],
    formats: ["Private booking", "Group program"],
    gradeLabel: "All ages (group-based)",
    shortDescription: "Private bookings of select programs like Pier Peer, Meet the Beach, Urban Birding, and Sea Stroll. Fun for birthday parties. Facility also available to rent.",
    costEligible: true,
  },

  /* Visitor Center / Stewardship / Access (ESI) */
  {
    id: "tiny-tides-storytime",
    name: "Tiny Tides Storytime",
    gradeBand: "PreK-2",
    pillar: "ESI",
    series: "Foundation",
    standards: "Early literacy + estuary themes",
    sessions: ["Monthly storytime + exhibit exploration"],
    formats: ["Visitor center", "Monthly program"],
    gradeLabel: "Families (children 12 and under with caregivers)",
    shortDescription: "Estuary-themed storytime for families, often paired with exhibit exploration and animal learning moments.",
    costEligible: false,
  },
  {
    id: "sensory-hour",
    name: "Sensory Hour",
    gradeBand: "All Ages",
    pillar: "ESI",
    series: "Foundation",
    standards: "Inclusive access and sensory-friendly learning",
    sessions: ["Monthly sensory-friendly open hours"],
    formats: ["Visitor center", "Access program"],
    gradeLabel: "All ages",
    shortDescription: "Sensory-friendly access hour designed to reduce barriers and support comfortable learning for all visitors.",
    costEligible: false,
  },
];

/* 4) Updated COST_CONFIG: adds All Ages + keeps your existing model */
const COST_CONFIG = {
  baseCoordinationFee: 50,
  hourlyRatePerInstructor: 25,
  markupMultiplier: 1.8,
  formats: { field: 1.0, multi: 1.15, camp: 1.25, virtual: 0.9 },

  // Add All Ages. Keep ratios conservative.
  ratios: {
    "PreK-2": 6,
    "3-5": 8,
    "6-8": 10,
    "8-10": 10,
    "10-12": 12,
    "Adult": 15,
    "All Ages": 12,
    default: 12
  },
};

/* 5) Update calculateCost + recalc to handle costEligible:false programs */
function calculateCost(program, participants, hours, formatKey) {
  // If not cost-eligible (resource/exhibit/training), return zeros
  if (program && program.costEligible === false) {
    return { totalProgramCost: 0, pricePerParticipant: 0, notApplicable: true };
  }

  const ratio = COST_CONFIG.ratios[program.gradeBand] ?? COST_CONFIG.ratios.default;
  const instructors = participants > 0 ? Math.ceil(participants / ratio) : 0;
  const staffCost = instructors * COST_CONFIG.hourlyRatePerInstructor * hours;
  const formatMult = COST_CONFIG.formats[formatKey] ?? COST_CONFIG.formats.field;

  const subtotal = staffCost + COST_CONFIG.baseCoordinationFee;
  const totalProgramCost = subtotal * COST_CONFIG.markupMultiplier * formatMult;
  const pricePerParticipant = participants > 0 ? totalProgramCost / participants : 0;

  return { totalProgramCost, pricePerParticipant, notApplicable: false };
}

function recalc() {
  const participants = Number(document.getElementById("inputParticipants").value);
  const hours = Number(document.getElementById("inputHours").value);
  const formatKey = document.getElementById("inputFormat").value;
  const errorEl = document.getElementById("inputError");

  errorEl.textContent = "";

  if (!activeProgramId) {
    document.getElementById("totalCost").textContent = "$0.00";
    document.getElementById("perParticipant").textContent = "$0.00";
    return;
  }

  const prog = PROGRAMS.find(p => p.id === activeProgramId);

  // Handle non-applicable cost programs
  const est = calculateCost(prog, participants, hours, formatKey);
  if (est.notApplicable) {
    document.getElementById("totalCost").textContent = "N/A";
    document.getElementById("perParticipant").textContent = "N/A";
    errorEl.textContent = "This item is a resource, exhibit, or training. Cost estimate is not applicable.";
    return;
  }

  if (!participants || participants <= 0 || !hours || hours <= 0) {
    errorEl.textContent = "Enter positive numbers for participants and hours.";
    document.getElementById("totalCost").textContent = "$0.00";
    document.getElementById("perParticipant").textContent = "$0.00";
    return;
  }

  document.getElementById("totalCost").textContent = `$${est.totalProgramCost.toFixed(2)}`;
  document.getElementById("perParticipant").textContent = `$${est.pricePerParticipant.toFixed(2)}`;
}
</script>
