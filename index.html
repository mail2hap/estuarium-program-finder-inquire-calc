<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Puget Sound Estuarium | Teacher Program Selector</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      /* Estuarium Style Guide Colors */
      --blue1: #b1c3cd; /* light */
      --blue2: #244191; /* deep */
      --blue3: #467f9c; /* mid */
      --green: #7daa6f;

      /* UI neutrals */
      --bg: #f6f8fb;
      --bg-alt: #ffffff;
      --card-bg: #ffffff;
      --text-main: #1f2a37;
      --text-muted: #5b677a;
      --border-subtle: rgba(36, 65, 145, 0.16);
      --shadow-soft: 0 10px 26px rgba(17, 24, 39, 0.10);
      --radius-lg: 14px;
      --radius-md: 10px;
      --radius-pill: 999px;
      --transition-fast: 160ms ease-out;

      --accent: var(--blue2);
      --accent-2: var(--blue3);
      --accent-soft: rgba(70, 127, 156, 0.14);
      --accent-soft-2: rgba(177, 195, 205, 0.45);
      --good: var(--green);
      --danger: #b42318;
    }

    * { box-sizing: border-box; }
    body{
      margin:0;
      font-family: Calibri, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text-main);
      background:
        radial-gradient(1200px 600px at 10% 0%, rgba(177,195,205,0.55) 0%, rgba(177,195,205,0) 55%),
        radial-gradient(900px 520px at 95% 10%, rgba(125,170,111,0.20) 0%, rgba(125,170,111,0) 60%),
        linear-gradient(180deg, #ffffff 0%, var(--bg) 55%, #ffffff 100%);
      -webkit-font-smoothing: antialiased;
    }
    a{ color:inherit; text-decoration:none; }
    .page{ min-height:100vh; display:flex; flex-direction:column; }

    header{
      padding: 22px clamp(16px, 4vw, 40px) 14px;
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      background: linear-gradient(90deg, var(--blue2) 0%, var(--blue3) 55%, var(--blue1) 100%);
      color:#fff;
      box-shadow: var(--shadow-soft);
      border-bottom: 1px solid rgba(255,255,255,0.22);
    }

    .brand{ display:flex; align-items:center; gap:12px; }
    .brand-mark{
      width: 34px; height: 34px;
      border-radius: 10px;
      background:
        radial-gradient(circle at 25% 30%, rgba(255,255,255,0.85) 0%, rgba(255,255,255,0) 55%),
        linear-gradient(135deg, var(--blue1) 0%, var(--blue3) 45%, var(--blue2) 100%);
      box-shadow: 0 0 0 2px rgba(255,255,255,0.25), 0 8px 18px rgba(0,0,0,0.16);
    }
    .brand-text{ display:flex; flex-direction:column; gap:2px; }
    .brand-text span:first-child{
      font-weight:700;
      letter-spacing:0.06em;
      font-size:0.82rem;
      text-transform:uppercase;
      opacity:0.95;
    }
    .brand-text span:last-child{
      font-size: 1.08rem;
      font-weight: 700;
      line-height: 1.1;
    }

    .header-right{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      font-size: 0.90rem;
      max-width: 720px;
      justify-content:flex-end;
    }

    .pill{
      border-radius: var(--radius-pill);
      border: 1px solid rgba(255,255,255,0.30);
      padding: 7px 12px;
      display:inline-flex;
      align-items:center;
      gap: 8px;
      background: rgba(255,255,255,0.14);
      backdrop-filter: blur(6px);
      font-weight: 700;
      font-size: 0.84rem;
      white-space: nowrap;
    }
    .pill-dot{
      width: 9px; height: 9px;
      border-radius: 999px;
      background: var(--green);
      box-shadow: 0 0 10px rgba(125,170,111,0.95);
    }

    main{
      padding: 14px clamp(16px, 4vw, 40px) 34px;
      max-width: 1200px;
      width:100%;
      margin: 0 auto 40px;
      display:grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.25fr);
      gap: 22px;
    }
    @media (max-width: 900px){
      main{ grid-template-columns: minmax(0, 1fr); }
    }

    .programs-panel, .details-panel{
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
    }

    .programs-panel{ padding: 18px; }
    .details-panel{ padding: 16px; display:flex; flex-direction:column; gap:12px; }

    .panel-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap: 10px;
      margin-bottom: 14px;
      flex-wrap:wrap;
    }
    .panel-title{
      font-size: 1.16rem;
      font-weight: 800;
      color: var(--blue2);
      letter-spacing: 0.01em;
    }
    .panel-subtitle{
      font-size: 0.88rem;
      color: var(--text-muted);
      margin-top: 4px;
      line-height: 1.35;
    }

    .filters{ display:flex; gap: 8px; flex-wrap:wrap; justify-content:flex-end; }

    .filter-wrapper{ position:relative; display:inline-flex; }
    .filter-wrapper::after{
      content:"▾";
      position:absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.76rem;
      color: rgba(255,255,255,0.85);
      pointer-events:none;
    }

    .filter-select{
      border-radius: var(--radius-pill);
      border: 1px solid rgba(255,255,255,0.35);
      background: rgba(255,255,255,0.18);
      color: #fff;
      padding: 7px 28px 7px 12px;
      font-size: 0.82rem;
      appearance:none;
      cursor:pointer;
      font-weight: 800;
      outline:none;
      min-width: 165px;
      backdrop-filter: blur(6px);
    }
    .filter-select:focus{
      box-shadow: 0 0 0 3px rgba(177,195,205,0.55);
      border-color: rgba(255,255,255,0.65);
    }
    .filter-select option{ color:#111; }

    .program-list{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 12px;
    }

    .program-card{
      background: var(--bg-alt);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(36,65,145,0.14);
      padding: 13px 12px;
      display:flex;
      flex-direction:column;
      gap: 7px;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast);
      cursor:pointer;
      text-align:left;
    }
    .program-card:hover{
      transform: translateY(-2px);
      box-shadow: 0 14px 30px rgba(17,24,39,0.10);
      border-color: rgba(36,65,145,0.45);
    }
    .program-card.active{
      border-color: rgba(125,170,111,0.95);
      box-shadow: 0 0 0 3px rgba(125,170,111,0.18), 0 14px 30px rgba(17,24,39,0.10);
      background: linear-gradient(180deg, #ffffff 0%, rgba(125,170,111,0.08) 100%);
    }

    .program-name{
      font-weight: 900;
      font-size: 0.98rem;
      color: var(--blue2);
      letter-spacing: 0.01em;
    }

    .badge{
      padding: 3px 9px;
      border-radius: var(--radius-pill);
      font-size: 0.70rem;
      border: 1px solid rgba(36,65,145,0.18);
      color: var(--text-muted);
      background: rgba(177,195,205,0.22);
      font-weight: 800;
      max-width: 100%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .badge-standards{
      border: 1px dashed rgba(70,127,156,0.65);
      background: rgba(70,127,156,0.10);
      color: var(--blue2);
    }

    .meta-row{
      display:flex;
      flex-wrap:wrap;
      gap: 6px;
      font-size: 0.72rem;
    }
    .meta-row span{
      padding: 2px 8px;
      border-radius: var(--radius-pill);
      background: rgba(177,195,205,0.22);
      border: 1px solid rgba(36,65,145,0.14);
      font-weight: 800;
      color: var(--text-muted);
    }

    .description{
      font-size: 0.80rem;
      color: var(--text-muted);
      line-height: 1.42;
      margin: 0;
    }

    .format-row{ display:flex; flex-wrap:wrap; gap: 5px; }
    .format-pill{
      font-size: 0.70rem;
      border-radius: var(--radius-pill);
      padding: 2px 8px;
      background: var(--accent-soft);
      border: 1px solid rgba(70,127,156,0.30);
      color: var(--blue2);
      font-weight: 900;
    }

    .quick-cost{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-top: 6px;
      font-size: 0.76rem;
      color: var(--text-muted);
      gap: 8px;
    }
    .quick-cost strong{
      font-size: 0.92rem;
      color: var(--blue2);
      font-weight: 900;
      white-space: nowrap;
    }

    .details-title{
      font-size: 1.10rem;
      font-weight: 900;
      color: var(--blue2);
    }
    .details-sub{
      font-size: 0.84rem;
      color: var(--text-muted);
      margin-top: 4px;
      line-height: 1.35;
    }

    .tag-row{ display:flex; flex-wrap:wrap; gap: 6px; margin-top: 6px; }
    .tag{
      font-size: 0.74rem;
      padding: 3px 9px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(70,127,156,0.30);
      background: rgba(70,127,156,0.10);
      color: var(--blue2);
      font-weight: 900;
    }

    .section-label{
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: rgba(36,65,145,0.75);
      margin-bottom: 4px;
      font-weight: 900;
    }

    .muted{ color: var(--text-muted); font-size: 0.80rem; line-height: 1.45; }

    .session-chips{ display:flex; flex-wrap:wrap; gap: 6px; margin: 6px 0 0; }
    .session-chip{
      font-size: 0.74rem;
      padding: 3px 9px;
      border-radius: var(--radius-pill);
      border: 1px dashed rgba(36,65,145,0.55);
      background: rgba(177,195,205,0.22);
      color: var(--blue2);
      font-weight: 900;
    }

    .cost-grid{
      display:grid;
      grid-template-columns: minmax(0,1.2fr) minmax(0,1fr);
      gap: 10px;
    }
    @media (max-width: 600px){
      .cost-grid{ grid-template-columns: minmax(0,1fr); }
    }

    .input-group{ display:flex; flex-direction:column; gap: 4px; margin-bottom: 8px; }
    label{ font-size: 0.80rem; color: var(--text-muted); font-weight: 900; }

    input[type="number"], select.input-select{
      border-radius: var(--radius-md);
      border: 1px solid rgba(36,65,145,0.18);
      background: rgba(177,195,205,0.18);
      color: var(--text-main);
      padding: 8px 9px;
      font-size: 0.86rem;
      outline:none;
      width:100%;
      font-weight: 900;
    }
    input[type="number"]:focus, select.input-select:focus{
      border-color: rgba(125,170,111,0.95);
      box-shadow: 0 0 0 3px rgba(125,170,111,0.20);
      background: rgba(125,170,111,0.10);
    }

    .cost-summary{
      background: linear-gradient(135deg, rgba(177,195,205,0.36), rgba(255,255,255,0.92));
      border-radius: var(--radius-md);
      padding: 10px 10px;
      border: 1px solid rgba(36,65,145,0.14);
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 8px;
    }
    .cost-item-label{ color: var(--text-muted); font-weight: 900; font-size: 0.80rem; }
    .cost-main{ font-size: 1.08rem; font-weight: 900; color: var(--blue2); }
    .cost-sub{ font-size: 0.92rem; color: var(--blue3); font-weight: 900; }
    .cost-footnote{ font-size: 0.74rem; color: var(--text-muted); margin-top: 4px; }

    .form-panel{
      margin-top: 6px;
      border-radius: var(--radius-md);
      border: 1px solid rgba(36,65,145,0.16);
      background: rgba(177,195,205,0.14);
      overflow:hidden;
      box-shadow: var(--shadow-soft);
    }
    .form-panel-header{
      padding: 8px 10px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 8px;
      background: linear-gradient(90deg, var(--blue2), var(--blue3));
      color:#fff;
      font-size: 0.84rem;
      font-weight: 900;
    }
    .form-panel-header button{
      border-radius: var(--radius-pill);
      border: 1px solid rgba(255,255,255,0.30);
      background: rgba(255,255,255,0.14);
      color:#fff;
      font-size: 0.76rem;
      padding: 5px 10px;
      cursor:pointer;
      font-weight: 900;
      transition: background 0.2s;
    }
    .form-panel-header button:hover{ background: rgba(255,255,255,0.22); }
    .form-panel iframe{
      border:none;
      width:100%;
      height: 380px;
      background:#fff;
    }

    .error-text{
      font-size: 0.76rem;
      color: var(--danger);
      margin-top: 2px;
      min-height: 1.2em;
      font-weight: 900;
    }

    .tiny-note{
      font-size: 0.75rem;
      color: var(--text-muted);
      line-height: 1.35;
      margin: 6px 0 0;
    }
    /* === FIX 1: Filters visible on white panel === */
.filters{
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  justify-content: flex-end;
  align-items: center;
}

.filter-wrapper{
  position: relative;
  display: inline-flex;
}

.filter-wrapper::after{
  content: "▾";
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 0.80rem;
  color: rgba(36, 65, 145, 0.70); /* blue2 tint */
  pointer-events: none;
}

.filter-select{
  border-radius: var(--radius-pill);
  border: 1px solid rgba(36, 65, 145, 0.22);
  background: rgba(177, 195, 205, 0.22); /* blue1 tint */
  color: var(--text-main);                /* dark text */
  padding: 8px 32px 8px 12px;
  font-size: 0.84rem;
  appearance: none;
  cursor: pointer;
  font-weight: 800;
  outline: none;
  min-width: 180px;
}

.filter-select:focus{
  border-color: rgba(125, 170, 111, 0.95); /* green */
  box-shadow: 0 0 0 3px rgba(125, 170, 111, 0.20);
  background: rgba(125, 170, 111, 0.10);
}

.filter-select option{
  color: #111;
}

/* If you want the filters to align left on smaller screens */
@media (max-width: 900px){
  .filters{
    justify-content: flex-start;
  }
  .filter-select{
    min-width: 220px;
  }
}

@media (max-width: 520px){
  .filter-select{
    width: 100%;
    min-width: 0;
  }
  .filter-wrapper{
    width: 100%;
  }
}

/* === FIX 2: Cost estimator layout (stack when it gets tight) === */
.cost-grid{
  display: grid;
  grid-template-columns: minmax(0, 1.15fr) minmax(0, 1fr);
  gap: 14px;
  align-items: start;
}

@media (max-width: 1050px){
  .cost-grid{
    grid-template-columns: 1fr; /* stack inputs and summary */
  }
}

.cost-summary{
  gap: 10px;
}

@media (max-width: 420px){
  .cost-summary{
    grid-template-columns: 1fr; /* stack “Estimated total” and “Per participant” */
  }
}
    /* === Page background: Estuarium green === */
body{
  background: #7daa6f !important;
}

/* Keep your white panels readable against the green */
.programs-panel,
.details-panel{
  background: #ffffff;
  border-color: rgba(255,255,255,0.30);
}

/* Optional: soften the edge so cards/panels pop */
.programs-panel,
.details-panel,
header{
  box-shadow: 0 14px 34px rgba(0,0,0,0.18);
}

/* If the header currently blends too much, give it separation */
header{
  border-bottom: 1px solid rgba(255,255,255,0.22);
}
    /* === Header: switch to Estuarium green === */
header{
  background: #7daa6f !important;
  color: #ffffff;
  border-bottom: 1px solid rgba(255,255,255,0.22);
}

/* Keep the filter pills readable on the green header */
.filter-wrapper::after{
  color: rgba(255,255,255,0.90) !important;
}

.filter-select{
  border: 1px solid rgba(255,255,255,0.35) !important;
  background: rgba(255,255,255,0.16) !important;
  color: #ffffff !important;
}

.filter-select:focus{
  box-shadow: 0 0 0 3px rgba(255,255,255,0.25) !important;
  border-color: rgba(255,255,255,0.65) !important;
  background: rgba(255,255,255,0.22) !important;
}

.filter-select option{
  color: #111 !important; /* dropdown menu text */
}
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="brand">
        <div class="brand-mark"></div>
        <div class="brand-text">
          <span>Puget Sound Estuarium</span>
          <span>Teacher Program Selector</span>
        </div>
      </div>
      <div class="header-right">
        <div class="pill">
          <span class="pill-dot"></span>
          <span>Now booking</span>
        </div>
        <span>Choose a program, preview a rough estimate, and submit an inquiry.</span>
      </div>
    </header>

    <main>
      <section class="programs-panel">
        <div class="panel-header">
          <div>
            <div class="panel-title">Programs at a glance</div>
            <div class="panel-subtitle">Filter by grade band, pillar, or program type. Click a program to see details.</div>
          </div>

          <div class="filters">
            <div class="filter-wrapper">
              <select id="gradeFilter" class="filter-select">
                <option value="">All grade bands</option>
                <option value="All Ages">All Ages</option>
                <option value="PreK-2">PreK–2</option>
                <option value="3-5">Grades 3–5</option>
                <option value="6-8">Grades 6–8</option>
                <option value="8-10">Grades 8–10</option>
                <option value="10-12">Grades 10–12</option>
                <option value="Adult">Adult</option>
              </select>
            </div>

            <div class="filter-wrapper">
              <select id="pillarFilter" class="filter-select">
                <option value="">All pillars</option>
                <option value="ELI">Estuarium Learning Initiative</option>
                <option value="EAN">Estuarium Action Network</option>
                <option value="ESI">Estuary Stewardship Initiative</option>
              </select>
            </div>

            <div class="filter-wrapper">
              <select id="typeFilter" class="filter-select">
                <option value="">All program types</option>
                <option value="Community Programs">Community Programs</option>
                <option value="K-12 Programs">K-12 Programs</option>
                <option value="Camps">Camps</option>
                <option value="Private Tour">Private Tour</option>
                <option value="Custom Inquiry">Custom Inquiry</option>
              </select>
            </div>
          </div>
        </div>

        <div id="programList" class="program-list"></div>
        <p class="tiny-note">
          Note: Some items (training, access hours, kits) are not priced as field programs. Those show N/A in the estimator.
        </p>
      </section>

      <section class="details-panel">
        <div>
          <div id="detailsTitle" class="details-title">Select a program to begin</div>
          <div id="detailsSub" class="details-sub">Description, tags, and available formats will appear here.</div>
        </div>

        <div id="detailsTags" class="tag-row"></div>

        <div style="margin-top: 10px;">
          <div class="section-label">Program overview</div>
          <p id="detailsDescription" class="muted">Use the filters on the left to narrow results, then click a program card.</p>
          <div class="session-chips" id="detailsSessions"></div>
        </div>

        <div style="margin-top: 10px;">
          <div class="section-label">Estimate your program cost</div>
          <div class="cost-grid">
            <div>
              <div class="input-group">
                <label for="inputParticipants">Number of participants</label>
                <input type="number" id="inputParticipants" min="1" value="25" />
              </div>

              <div class="input-group">
                <label for="inputHours">Program length (hours)</label>
                <input type="number" id="inputHours" min="0.5" step="0.5" value="2" />
              </div>

              <div class="input-group">
                <label for="inputFormat">Session format</label>
                <select id="inputFormat" class="input-select">
                  <option value="field">1-day field trip</option>
                  <option value="multi">Multi-week series</option>
                  <option value="camp">Camp or multi-day</option>
                  <option value="virtual">Virtual or on-campus</option>
                </select>
              </div>

              <div class="error-text" id="inputError"></div>
            </div>

            <div>
              <div class="cost-summary">
                <div>
                  <div class="cost-item-label">Estimated total</div>
                  <div id="totalCost" class="cost-main">$0.00</div>
                  <div class="cost-footnote">Includes instruction and coordination.</div>
                </div>
                <div>
                  <div class="cost-item-label">Per participant</div>
                  <div id="perParticipant" class="cost-sub">$0.00</div>
                  <div class="cost-footnote">Based on group size.</div>
                </div>
              </div>
            </div>
          </div>
          <p class="cost-footnote">This is a working estimate. Final pricing is confirmed after inquiry.</p>
        </div>

        <div>
          <div class="section-label">Submit a program inquiry</div>
          <p class="muted">The form will attempt to prefill the program name you selected.</p>

          <div class="form-panel">
            <div class="form-panel-header">
              <span id="formProgramLabel">No program selected yet</span>
              <button type="button" onclick="openFormInNewTab()">Open in new tab</button>
            </div>
            <iframe
              id="inquiryFormFrame"
              title="Estuarium Program Inquiry"
              src="https://docs.google.com/forms/d/e/1FAIpQLSdHIjWiwmRy14Est89RnyVMbHxuHUyKDItmp3DNHAJXzRK1jQ/viewform?embedded=true">
            </iframe>
          </div>
        </div>
      </section>
    </main>
  </div>

<script>
/*
  Program Type values (as requested):
  - Community Programs
  - K-12 Programs
  - Camps
  - Private Tour
  - Custom Inquiry
*/

const PROGRAMS = [
  /* SoundPath (K-12) */
  {
    id: "sound-sprouts",
    name: "Sound Sprouts",
    gradeBand: "PreK-2",
    pillar: "ELI",
    programType: "K-12 Programs",
    standards: "Foundational NGSS; early learning",
    sessions: ["Bring the Outside In"],
    formats: ["2–3 hours"],
    gradeLabel: "Infant–PreK with caregiver",
    shortDescription: "Indoor playful, sensory-based estuary exploration for caregivers and young children.",
    costEligible: true
  },
  {
    id: "little-sound-scouts",
    name: "Little Sound Scouts",
    gradeBand: "PreK-2",
    pillar: "ELI",
    programType: "K-12 Programs",
    standards: "NGSS K-ESS2-1, K-LS1-1",
    sessions: ["10-week: Seasons Around the Sound", "4-week: Small Scientists by the Shore", "5-day camp: My Estuary Adventure", "1-day: Little Beachcombers"],
    formats: ["10-week", "4-week", "5-day camp", "1-day field trip"],
    gradeLabel: "Grades K–2",
    shortDescription: "Early elementary nature adventures focusing on observation, wonder, and estuary exploration.",
    costEligible: true
  },
  {
    id: "sound-detectives",
    name: "Sound Detectives",
    gradeBand: "3-5",
    pillar: "ELI",
    programType: "K-12 Programs",
    standards: "NGSS 3-LS4-3, 4-ESS2-2, 5-PS1-3",
    sessions: ["10-week: Unlocking Estuary Mysteries", "4-week: Intro to Investigation", "5-day camp: Shifting Shoreline", "1-day: Junior Investigator"],
    formats: ["10-week", "4-week", "5-day camp", "1-day field trip"],
    gradeLabel: "Grades 3–5",
    shortDescription: "Inquiry-based field science where students collect data, map habitats, and solve estuary mysteries.",
    costEligible: true
  },
  {
    id: "eco-navigators",
    name: "Eco Navigators",
    gradeBand: "6-8",
    pillar: "ELI",
    programType: "K-12 Programs",
    standards: "Middle school NGSS (LS2.A, ESS3.C)",
    sessions: ["10-week: Estuary Navigation Lab", "4-week: Four-Way Compass", "5-day camp: Estuary Action Lab", "1-day: Compass Field Day"],
    formats: ["10-week", "4-week", "5-day camp", "1-day field trip"],
    gradeLabel: "Grades 6–8",
    shortDescription: "Middle school field program using navigation, mapping, and stewardship projects.",
    costEligible: true
  },
  {
    id: "echo-sounders",
    name: "Echo Sounders",
    gradeBand: "8-10",
    pillar: "ELI",
    programType: "K-12 Programs",
    standards: "MS-LS2-2, MS-LS2-5, MS-ESS3-3",
    sessions: ["10-week: Field Science Foundations", "4-week: Teamwork + Data", "5-day camp: Echoes from the Shore", "1-day: Science Belongs to You"],
    formats: ["10-week", "4-week", "5-day camp", "1-day intensive"],
    gradeLabel: "Grades 8–10",
    shortDescription: "Field science that builds teamwork, research skills, and leadership readiness.",
    costEligible: true
  },
  {
    id: "sound-quest",
    name: "SoundQuest",
    gradeBand: "8-10",
    pillar: "ELI",
    programType: "K-12 Programs",
    standards: "MS-LS2-1, MS-LS2-5, MS-ESS3-3",
    sessions: ["10-week: Queer Ecology in Action", "4-week: Estuary, Identity, and Action", "5-day camp: Field Science for Queer Belonging", "1-day: Estuary Identity Intensive"],
    formats: ["10-week", "4-week", "5-day camp", "1-day intensive"],
    gradeLabel: "Grades 8–12 (LGBTQIA youth)",
    shortDescription: "Queer-inclusive estuary program combining field science, arts, and identity-affirming leadership.",
    costEligible: true
  },
  {
    id: "sound-scholars",
    name: "Sound Scholars",
    gradeBand: "10-12",
    pillar: "ELI",
    programType: "K-12 Programs",
    standards: "HS-LS2-6, HS-ESS3-4, HS-ETS1-3",
    sessions: ["10-week: Leadership Through Estuary Science", "4-week: Youth Science in Action", "5-day camp: Science, Stewardship, and Story", "1-day: Lead Like a Scientist"],
    formats: ["10-week", "4-week", "5-day camp", "1-day intensive"],
    gradeLabel: "Grades 10–12",
    shortDescription: "Advanced high school field research, science communication, and youth leadership.",
    costEligible: true
  },

  /* SoundPath (Adult) */
  {
    id: "sound-trekkers",
    name: "Sound Trekkers",
    gradeBand: "Adult",
    pillar: "EAN",
    programType: "Community Programs",
    standards: "Adult field science and stewardship learning",
    sessions: ["10-week: Knowing the Sound, Caring for the Sound", "4-week: Estuary Essentials", "1-day: Walk the Estuary"],
    formats: ["10-week", "4-week", "1-day"],
    gradeLabel: "Adults 18+",
    shortDescription: "Immersive adult field program for aspiring naturalists and community stewards.",
    costEligible: true
  },
  {
    id: "our-sound-selves",
    name: "Our Sound Selves",
    gradeBand: "Adult",
    pillar: "ESI",
    programType: "Community Programs",
    standards: "Ecological literacy + reflective learning",
    sessions: ["10-week: The Estuary Within", "4-week: Reflections in the Water", "1-day: The Sound Within"],
    formats: ["10-week", "4-week", "1-day"],
    gradeLabel: "Adults 18+",
    shortDescription: "Estuary learning that connects science, personal reflection, and stewardship.",
    costEligible: true
  },

  /* Programs found on pugetsoundestuarium.org (incorporated) */

  /* K–12 Programs */
  {
    id: "field-trips-prek-12",
    name: "Field Trips (PreK–12)",
    gradeBand: "All Ages",
    pillar: "ELI",
    programType: "K-12 Programs",
    standards: "NGSS-aligned place-based learning",
    sessions: ["Custom field trip modules by grade band"],
    formats: ["Field trip", "On-site", "Off-site"],
    gradeLabel: "PreK–12",
    shortDescription: "School field experiences connecting students to Puget Sound estuaries through hands-on learning.",
    costEligible: true
  },
  {
    id: "estuary-life-landforms",
    name: "Estuary Life & Landforms (ELL)",
    gradeBand: "3-5",
    pillar: "ELI",
    programType: "K-12 Programs",
    standards: "Place-based estuary science",
    sessions: ["Virtual or on-campus module"],
    formats: ["Virtual", "On-campus"],
    gradeLabel: "5th grade focus",
    shortDescription: "Learning about Budd Inlet, estuary habitats, and landforms through an in-classroom or virtual module.",
    costEligible: true
  },
  {
    id: "bayshore-fieldstem",
    name: "Bayshore FieldSTEM",
    gradeBand: "6-8",
    pillar: "ELI",
    programType: "K-12 Programs",
    standards: "FieldSTEM model; NGSS-aligned",
    sessions: ["Field-based STEM learning at Bayshore Preserve"],
    formats: ["Field program", "Partner site"],
    gradeLabel: "7th grade focus",
    shortDescription: "Outdoor STEM learning using a FieldSTEM approach at Bayshore Preserve.",
    costEligible: true
  },

  /* Camps */
  {
    id: "estuary-explorers-summer-camp",
    name: "Estuary Explorers Summer Camp",
    gradeBand: "3-5",
    pillar: "ELI",
    programType: "Camps",
    standards: "Hands-on marine and estuary science",
    sessions: ["Seasonal camp sessions"],
    formats: ["Camp", "Multi-day"],
    gradeLabel: "Grades 2–8",
    shortDescription: "Hands-on summer camp focused on estuary exploration, discovery, and field science.",
    costEligible: true
  },
  {
    id: "estuary-investigation-camps",
    name: "Estuary Investigation Camps",
    gradeBand: "10-12",
    pillar: "ELI",
    programType: "Camps",
    standards: "Field investigation and applied ecology",
    sessions: ["Seasonal investigation camps"],
    formats: ["Camp", "Multi-day"],
    gradeLabel: "Grades 8–12",
    shortDescription: "Multi-day investigation camps for older youth featuring deeper field science and inquiry.",
    costEligible: true
  },

  /* Community Programs */
  {
    id: "pier-peer",
    name: "Pier Peer",
    gradeBand: "All Ages",
    pillar: "EAN",
    programType: "Community Programs",
    standards: "Community science and species ID",
    sessions: ["Nighttime pier exploration"],
    formats: ["Public event", "Night program"],
    gradeLabel: "All ages",
    shortDescription: "Nighttime dockside exploration using underwater lights to discover estuary creatures with staff guidance.",
    costEligible: true
  },
  {
    id: "meet-the-beach",
    name: "Meet the Beach",
    gradeBand: "All Ages",
    pillar: "EAN",
    programType: "Community Programs",
    standards: "Intertidal ecology and community learning",
    sessions: ["Low-tide shoreline exploration series"],
    formats: ["Public program", "Low tide"],
    gradeLabel: "All ages",
    shortDescription: "Low-tide shoreline program supported by trained Beach Naturalists for species ID and intertidal discovery.",
    costEligible: true
  },
  {
    id: "tiny-tides-storytime",
    name: "Tiny Tides Storytime",
    gradeBand: "PreK-2",
    pillar: "ESI",
    programType: "Community Programs",
    standards: "Early literacy + estuary themes",
    sessions: ["Monthly storytime + exhibit exploration"],
    formats: ["Visitor center", "Monthly program"],
    gradeLabel: "Families",
    shortDescription: "Estuary-themed storytime for families, paired with exhibit exploration and animal learning moments.",
    costEligible: false
  },
  {
    id: "sensory-hour",
    name: "Sensory Hour",
    gradeBand: "All Ages",
    pillar: "ESI",
    programType: "Community Programs",
    standards: "Inclusive access and sensory-friendly learning",
    sessions: ["Monthly sensory-friendly open hours"],
    formats: ["Visitor center", "Access program"],
    gradeLabel: "All ages",
    shortDescription: "Sensory-friendly access hour designed to reduce barriers and support comfortable learning for all visitors.",
    costEligible: false
  },
  {
    id: "discovery-speaker-series",
    name: "Discovery Speaker Series",
    gradeBand: "Adult",
    pillar: "EAN",
    programType: "Community Programs",
    standards: "Public learning: science, restoration, stewardship",
    sessions: ["Talks with scientists, educators, artists, and advocates"],
    formats: ["Community event", "Talk"],
    gradeLabel: "Adult-leaning (open to all)",
    shortDescription: "Free public talks featuring local research, restoration, and community learning.",
    costEligible: false
  },

  /* Private Tour */
  {
    id: "urban-birding",
    name: "Urban Birding",
    gradeBand: "All Ages",
    pillar: "EAN",
    programType: "Private Tour",
    standards: "Bird identification and urban habitat learning",
    sessions: ["Guided birding tour"],
    formats: ["Guided tour"],
    gradeLabel: "All ages",
    shortDescription: "Guided urban birding tour highlighting local species and habitat connections.",
    costEligible: true
  },
  {
    id: "sea-stroll",
    name: "Sea Stroll (Historic Shoreline Tours)",
    gradeBand: "All Ages",
    pillar: "EAN",
    programType: "Private Tour",
    standards: "Shoreline change, history, and place-based learning",
    sessions: ["Guided shoreline tour"],
    formats: ["Guided tour"],
    gradeLabel: "All ages",
    shortDescription: "Guided shoreline walks connecting local history with estuary ecology.",
    costEligible: true
  },

  /* Custom Inquiry */
  {
    id: "private-events",
    name: "Private Events (Program Bookings)",
    gradeBand: "All Ages",
    pillar: "EAN",
    programType: "Custom Inquiry",
    standards: "Custom program delivery for groups",
    sessions: ["Private booking options for select programs"],
    formats: ["Private booking", "Group program"],
    gradeLabel: "All ages",
    shortDescription: "Private bookings of select programs like Pier Peer, Meet the Beach, Urban Birding, and Sea Stroll.",
    costEligible: true
  },
  {
    id: "school-estuary-kits",
    name: "School Estuary Kits (Checkout & Purchase)",
    gradeBand: "All Ages",
    pillar: "ELI",
    programType: "Custom Inquiry",
    standards: "Classroom-ready estuary science resources",
    sessions: ["Multiple estuary themed kits available"],
    formats: ["Curriculum kit", "Classroom"],
    gradeLabel: "K–12 (kit-based)",
    shortDescription: "Estuary-themed classroom kits available for checkout or purchase to support teacher-led learning.",
    costEligible: false
  }
];

const COST_CONFIG = {
  baseCoordinationFee: 50,
  hourlyRatePerInstructor: 25,
  markupMultiplier: 1.8,
  formats: { field: 1.0, multi: 1.15, camp: 1.25, virtual: 0.9 },
  ratios: { "PreK-2": 6, "3-5": 8, "6-8": 10, "8-10": 10, "10-12": 12, "Adult": 15, "All Ages": 12, default: 12 }
};

let activeProgramId = null;

function money(n){
  if (typeof n !== "number" || !isFinite(n)) return "$0.00";
  return "$" + n.toFixed(2);
}

function calculateCost(program, participants, hours, formatKey) {
  if (program && program.costEligible === false) {
    return { totalProgramCost: 0, pricePerParticipant: 0, notApplicable: true };
  }
  const ratio = COST_CONFIG.ratios[program.gradeBand] ?? COST_CONFIG.ratios.default;
  const instructors = participants > 0 ? Math.ceil(participants / ratio) : 0;
  const staffCost = instructors * COST_CONFIG.hourlyRatePerInstructor * hours;
  const formatMult = COST_CONFIG.formats[formatKey] ?? COST_CONFIG.formats.field;
  const subtotal = staffCost + COST_CONFIG.baseCoordinationFee;
  const totalProgramCost = subtotal * COST_CONFIG.markupMultiplier * formatMult;
  const pricePerParticipant = participants > 0 ? totalProgramCost / participants : 0;
  return { totalProgramCost, pricePerParticipant, notApplicable: false };
}

function renderPrograms() {
  const gradeFilter = document.getElementById("gradeFilter")?.value || "";
  const pillarFilter = document.getElementById("pillarFilter")?.value || "";
  const typeFilter = document.getElementById("typeFilter")?.value || "";

  const listEl = document.getElementById("programList");
  listEl.innerHTML = "";

  const visible = PROGRAMS.filter(p => {
    if (gradeFilter && p.gradeBand !== gradeFilter) return false;
    if (pillarFilter && p.pillar !== pillarFilter) return false;
    if (typeFilter && p.programType !== typeFilter) return false;
    return true;
  });

  visible.forEach(prog => {
    const card = document.createElement("button");
    card.className = "program-card";
    card.type = "button";
    card.dataset.id = prog.id;
    if (activeProgramId === prog.id) card.classList.add("active");

    const est = calculateCost(prog, 25, 2, "field");
    const costText = est.notApplicable ? "N/A" : "$" + est.totalProgramCost.toFixed(0);

    card.innerHTML = `
      <div style="display:flex; justify-content:space-between; align-items:center; gap:6px; flex-wrap:wrap;">
        <div class="program-name">${prog.name}</div>
        <span class="badge badge-standards" title="${prog.standards}">${prog.standards}</span>
      </div>
      <div class="meta-row">
        <span>${prog.gradeLabel}</span>
        <span>${prog.programType}</span>
        <span>${prog.pillar}</span>
      </div>
      <p class="description">${prog.shortDescription}</p>
      <div class="format-row">
        ${(prog.formats || []).map(f => `<span class="format-pill">${f}</span>`).join("")}
      </div>
      <div class="quick-cost">
        <span>Example: 25 participants · 2 hr</span>
        <span>from <strong>${costText}</strong></span>
      </div>
    `;

    card.addEventListener("click", () => setActiveProgram(prog.id));
    listEl.appendChild(card);
  });

  if (!visible.some(p => p.id === activeProgramId)) activeProgramId = null;
  if (!activeProgramId && visible.length > 0) setActiveProgram(visible[0].id);

  if (visible.length === 0) {
    const empty = document.createElement("div");
    empty.className = "muted";
    empty.style.padding = "10px 2px";
    empty.textContent = "No programs match the selected filters.";
    listEl.appendChild(empty);
  }
}

function setActiveProgram(id) {
  const prog = PROGRAMS.find(p => p.id === id);
  if (!prog) return;
  activeProgramId = id;

  document.querySelectorAll(".program-card").forEach(c => {
    c.classList.toggle("active", c.dataset.id === id);
  });

  document.getElementById("detailsTitle").textContent = prog.name;
  document.getElementById("detailsSub").textContent = `${prog.programType} · ${prog.gradeLabel} · Pillar ${prog.pillar}`;
  document.getElementById("detailsDescription").textContent = prog.shortDescription;

  const tagsEl = document.getElementById("detailsTags");
  tagsEl.innerHTML = `
    <span class="tag">Type: ${prog.programType}</span>
    <span class="tag">Grade band: ${prog.gradeBand}</span>
    <span class="tag">Pillar: ${prog.pillar}</span>
    <span class="tag">${prog.standards}</span>
  `;

  const sessionsEl = document.getElementById("detailsSessions");
  sessionsEl.innerHTML = (prog.sessions || []).map(s => `<span class="session-chip">${s}</span>`).join("");

  document.getElementById("formProgramLabel").textContent = `Inquiry form for: ${prog.name}`;
  updateFormPrefill();
  recalc();
}

function recalc() {
  const participants = Number(document.getElementById("inputParticipants").value);
  const hours = Number(document.getElementById("inputHours").value);
  const formatKey = document.getElementById("inputFormat").value;
  const errorEl = document.getElementById("inputError");

  errorEl.textContent = "";

  if (!activeProgramId) {
    document.getElementById("totalCost").textContent = "$0.00";
    document.getElementById("perParticipant").textContent = "$0.00";
    return;
  }

  const prog = PROGRAMS.find(p => p.id === activeProgramId);
  const est = calculateCost(prog, participants, hours, formatKey);

  if (est.notApplicable) {
    document.getElementById("totalCost").textContent = "N/A";
    document.getElementById("perParticipant").textContent = "N/A";
    errorEl.textContent = "This item is not priced through the estimator. Use the inquiry form for details.";
    return;
  }

  if (!participants || participants <= 0 || !hours || hours <= 0) {
    errorEl.textContent = "Enter positive numbers for participants and hours.";
    document.getElementById("totalCost").textContent = "$0.00";
    document.getElementById("perParticipant").textContent = "$0.00";
    return;
  }

  document.getElementById("totalCost").textContent = money(est.totalProgramCost);
  document.getElementById("perParticipant").textContent = money(est.pricePerParticipant);
}

/*
  Prefill: replace entry.123456789 with the real field ID from your Google Form
  if you want true prefill behavior.
*/
function updateFormPrefill() {
  const baseUrl = "https://docs.google.com/forms/d/e/1FAIpQLSdHIjWiwmRy14Est89RnyVMbHxuHUyKDItmp3DNHAJXzRK1jQ/viewform";
  const prog = PROGRAMS.find(p => p.id === activeProgramId);

  const entryId = "entry.123456789"; // TODO: update to your real field ID
  const url = prog
    ? `${baseUrl}?embedded=true&${entryId}=${encodeURIComponent(prog.name)}`
    : `${baseUrl}?embedded=true`;

  document.getElementById("inquiryFormFrame").src = url;
}

function openFormInNewTab() {
  const baseUrl = "https://docs.google.com/forms/d/e/1FAIpQLSdHIjWiwmRy14Est89RnyVMbHxuHUyKDItmp3DNHAJXzRK1jQ/viewform";
  const prog = PROGRAMS.find(p => p.id === activeProgramId);

  const entryId = "entry.123456789"; // TODO: update to your real field ID
  const url = prog
    ? `${baseUrl}?${entryId}=${encodeURIComponent(prog.name)}`
    : baseUrl;

  window.open(url, "_blank");
}

/* Event listeners */
document.getElementById("inputParticipants").addEventListener("input", recalc);
document.getElementById("inputHours").addEventListener("input", recalc);
document.getElementById("inputFormat").addEventListener("change", recalc);

document.getElementById("gradeFilter").addEventListener("change", renderPrograms);
document.getElementById("pillarFilter").addEventListener("change", renderPrograms);
document.getElementById("typeFilter").addEventListener("change", renderPrograms);

/* Initial render */
renderPrograms();
</script>
</body>
</html>
