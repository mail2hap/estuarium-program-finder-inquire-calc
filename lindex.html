<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Estuarium Education Programs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Estuarium Style Guide alignment:
       Fonts: Calibri (online/headlines), Times New Roman (print/alt headings)
       Colors: Blue #1 #b1c3cd, Blue #2 #244191, Blue #3 #467f9c, Green #7daa6f
  -->
  <style>
    :root {
      /* Brand palette (from Estuarium Style Guide) */
      --est-blue-1: #b1c3cd; /* light */
      --est-blue-2: #244191; /* deep */
      --est-blue-3: #467f9c; /* mid */
      --est-green:  #7daa6f; /* accent */

      /* UI tokens mapped to brand */
      --bg: #f6f8fa;
      --bg-alt: #ffffff;
      --card-bg: #ffffff;

      --accent: var(--est-blue-2);
      --accent-2: var(--est-blue-3);
      --accent-soft: rgba(36, 65, 145, 0.10);
      --accent-soft-2: rgba(70, 127, 156, 0.12);

      --good: var(--est-green);
      --good-soft: rgba(125, 170, 111, 0.14);

      --text-main: #1f2a37;
      --text-muted: #5b6675;

      --border-subtle: rgba(36, 65, 145, 0.16);

      --shadow-soft: 0 8px 20px rgba(17, 24, 39, 0.10);
      --shadow-tight: 0 2px 10px rgba(17, 24, 39, 0.08);

      --radius-lg: 14px;
      --radius-md: 10px;
      --radius-pill: 999px;

      --transition-fast: 160ms ease-out;
      --focus-ring: 0 0 0 3px rgba(125, 170, 111, 0.28);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: Calibri, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(900px 520px at 10% 0%, rgba(177, 195, 205, 0.55), transparent 55%),
        radial-gradient(900px 520px at 100% 0%, rgba(70, 127, 156, 0.22), transparent 55%),
        linear-gradient(180deg, #f8fafc 0%, #f2f6f8 100%);
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    a { color: inherit; text-decoration: none; }

    .page { min-height: 100vh; display: flex; flex-direction: column; }

    header {
      padding: 20px clamp(18px, 4vw, 40px) 12px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 12px;

      background: linear-gradient(180deg, var(--est-blue-2) 0%, var(--est-blue-3) 100%);
      color: #fff;
      box-shadow: var(--shadow-soft);
      border-bottom: 1px solid rgba(255,255,255,0.18);
    }

    .brand { display: flex; align-items: center; gap: 12px; }

    .brand-mark {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background:
        radial-gradient(circle at 35% 30%, rgba(255,255,255,0.92) 0%, rgba(255,255,255,0.18) 45%, transparent 60%),
        linear-gradient(135deg, var(--est-blue-1) 0%, var(--est-blue-3) 55%, var(--est-blue-2) 100%);
      box-shadow:
        0 0 0 2px rgba(255,255,255,0.26),
        0 6px 18px rgba(0, 0, 0, 0.20);
    }

    .brand-text { display: flex; flex-direction: column; gap: 2px; }

    .brand-text span:first-child {
      font-family: Calibri, system-ui, sans-serif;
      font-weight: 700;
      letter-spacing: 0.06em;
      font-size: 0.80rem;
      text-transform: uppercase;
      opacity: 0.95;
    }

    .brand-text span:last-child {
      font-family: Calibri, system-ui, sans-serif;
      font-size: 1.04rem;
      font-weight: 700;
      line-height: 1.15;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.90rem;
      flex-wrap: wrap;
      opacity: 0.96;
    }

    .pill {
      border-radius: var(--radius-pill);
      border: 1px solid rgba(255, 255, 255, 0.26);
      padding: 6px 12px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(255, 255, 255, 0.14);
      backdrop-filter: blur(6px);
    }

    .pill-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--est-green);
      box-shadow: 0 0 10px rgba(125, 170, 111, 0.85);
    }

    main {
      padding: 14px clamp(18px, 4vw, 40px) 32px;
      max-width: 1200px;
      width: 100%;
      margin: 0 auto 40px;
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.3fr);
      gap: 24px;
    }

    @media (max-width: 900px) {
      main { grid-template-columns: minmax(0, 1fr); }
    }

    .programs-panel {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 18px;
      box-shadow: var(--shadow-tight);
      border: 1px solid var(--border-subtle);
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      gap: 10px;
      margin-bottom: 14px;
      flex-wrap: wrap;
      border-bottom: 1px solid rgba(36, 65, 145, 0.10);
      padding-bottom: 12px;
    }

    .panel-title { font-size: 1.15rem; font-weight: 800; color: var(--text-main); }
    .panel-subtitle { font-size: 0.86rem; color: var(--text-muted); margin-top: 4px; }

    .filters { display: flex; gap: 8px; flex-wrap: wrap; }

    .filter-select {
      border-radius: var(--radius-pill);
      border: 1px solid rgba(36, 65, 145, 0.20);
      background: #f3f7fa;
      color: var(--text-main);
      padding: 7px 28px 7px 12px;
      font-size: 0.82rem;
      appearance: none;
      cursor: pointer;
      font-weight: 700;
    }

    .filter-select:focus {
      outline: none;
      box-shadow: var(--focus-ring);
      border-color: rgba(125, 170, 111, 0.55);
      background: #ffffff;
    }

    .filter-wrapper { position: relative; display: inline-flex; }
    .filter-wrapper::after {
      content: "▾";
      position: absolute;
      right: 10px;
      font-size: 0.72rem;
      color: rgba(31, 42, 55, 0.65);
      pointer-events: none;
    }

    .program-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 12px;
    }

    .program-card {
      background: var(--bg-alt);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(36, 65, 145, 0.16);
      padding: 13px 12px;
      display: flex;
      flex-direction: column;
      gap: 7px;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast), background var(--transition-fast);
      cursor: pointer;

      /* button reset */
      text-align: left;
      width: 100%;
      font-family: inherit;
    }

    .program-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 24px rgba(17, 24, 39, 0.14);
      border-color: rgba(70, 127, 156, 0.55);
      background: rgba(177, 195, 205, 0.16);
    }

    .program-card:focus {
      outline: none;
      box-shadow: var(--focus-ring);
      border-color: rgba(125, 170, 111, 0.55);
    }

    .program-card.active {
      border-color: rgba(125, 170, 111, 0.85);
      box-shadow: 0 0 0 3px rgba(125, 170, 111, 0.20);
      background: rgba(125, 170, 111, 0.10);
    }

    .program-name { font-weight: 800; font-size: 0.94rem; color: var(--text-main); }

    .badge {
      padding: 3px 9px;
      border-radius: var(--radius-pill);
      font-size: 0.70rem;
      border: 1px solid rgba(36, 65, 145, 0.16);
      color: rgba(31, 42, 55, 0.78);
      background: #f3f7fa;
      font-weight: 700;
    }

    .badge-standards {
      border: 1px dashed rgba(70, 127, 156, 0.60);
      background: rgba(70, 127, 156, 0.12);
      color: var(--est-blue-2);
    }

    .meta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      font-size: 0.72rem;
    }

    .meta-row span {
      padding: 2px 7px;
      border-radius: var(--radius-pill);
      background: #f3f7fa;
      border: 1px solid rgba(36, 65, 145, 0.14);
      font-weight: 700;
      color: rgba(31, 42, 55, 0.72);
    }

    .description {
      font-size: 0.80rem;
      color: var(--text-muted);
      line-height: 1.45;
    }

    .format-row { display: flex; flex-wrap: wrap; gap: 4px; }

    .format-pill {
      font-size: 0.70rem;
      border-radius: var(--radius-pill);
      padding: 2px 8px;
      background: rgba(36, 65, 145, 0.08);
      border: 1px solid rgba(36, 65, 145, 0.22);
      color: var(--est-blue-2);
      font-weight: 800;
    }

    .quick-cost {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 6px;
      font-size: 0.76rem;
      color: rgba(31, 42, 55, 0.68);
    }

    .quick-cost strong {
      font-size: 0.92rem;
      color: var(--est-green);
      font-weight: 900;
    }

    .details-panel {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 16px;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-tight);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .details-title {
      font-size: 1.08rem;
      font-weight: 900;
      color: var(--text-main);
    }

    .details-sub { font-size: 0.82rem; color: var(--text-muted); margin-top: 4px; }

    .tag-row { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 6px; }

    .tag {
      font-size: 0.72rem;
      padding: 3px 8px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(36, 65, 145, 0.22);
      background: rgba(36, 65, 145, 0.08);
      color: var(--est-blue-2);
      font-weight: 800;
    }

    .section-label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: rgba(31, 42, 55, 0.70);
      margin-bottom: 4px;
      font-weight: 900;
    }

    .cost-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1.2fr);
      gap: 10px;
    }

    @media (max-width: 600px) {
      .cost-grid { grid-template-columns: minmax(0, 1fr); }
    }

    .input-group { display: flex; flex-direction: column; gap: 4px; margin-bottom: 6px; }

    label { font-size: 0.78rem; color: var(--text-muted); font-weight: 800; }

    input[type="number"],
    select {
      border-radius: var(--radius-md);
      border: 1px solid rgba(36, 65, 145, 0.20);
      background: #f3f7fa;
      color: var(--text-main);
      padding: 8px 10px;
      font-size: 0.82rem;
      outline: none;
      width: 100%;
      font-weight: 700;
    }

    input[type="number"]:focus,
    select:focus {
      border-color: rgba(125, 170, 111, 0.65);
      box-shadow: var(--focus-ring);
      background: #ffffff;
    }

    .cost-summary {
      background: linear-gradient(135deg, rgba(177, 195, 205, 0.26), rgba(255,255,255,0.75));
      border-radius: var(--radius-md);
      padding: 10px 10px;
      border: 1px solid rgba(36, 65, 145, 0.18);
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }

    .cost-item-label { color: rgba(31, 42, 55, 0.70); font-weight: 800; font-size: 0.78rem; }
    .cost-main { font-size: 1.05rem; font-weight: 900; color: var(--est-blue-2); }
    .cost-sub  { font-size: 0.92rem; color: var(--est-green); font-weight: 900; }
    .cost-footnote { font-size: 0.72rem; color: rgba(31, 42, 55, 0.66); margin-top: 2px; }

    .form-panel {
      margin-top: 6px;
      border-radius: var(--radius-md);
      border: 1px solid rgba(36, 65, 145, 0.18);
      background: #ffffff;
      overflow: hidden;
      box-shadow: var(--shadow-tight);
    }

    .form-panel-header {
      padding: 8px 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      background: linear-gradient(90deg, var(--est-blue-2), var(--est-blue-3));
      color: #fff;
      font-size: 0.82rem;
      font-weight: 800;
    }

    .form-panel-header button {
      border-radius: var(--radius-pill);
      border: 1px solid rgba(255, 255, 255, 0.30);
      background: rgba(255, 255, 255, 0.14);
      color: #fff;
      font-size: 0.74rem;
      padding: 5px 10px;
      cursor: pointer;
      font-weight: 800;
      transition: background var(--transition-fast), transform var(--transition-fast);
    }

    .form-panel-header button:hover {
      background: rgba(255, 255, 255, 0.22);
      transform: translateY(-1px);
    }

    .form-panel iframe {
      border: none;
      width: 100%;
      height: 360px;
      background: #fff;
    }

    .muted { color: var(--text-muted); font-size: 0.80rem; }

    .session-chips { display: flex; flex-wrap: wrap; gap: 6px; margin: 6px 0 2px; }

    .session-chip {
      font-size: 0.72rem;
      padding: 4px 8px;
      border-radius: var(--radius-pill);
      border: 1px dashed rgba(70, 127, 156, 0.60);
      background: rgba(70, 127, 156, 0.12);
      color: var(--est-blue-2);
      font-weight: 800;
    }

    .error-text {
      font-size: 0.72rem;
      color: #b42318;
      margin-top: 2px;
      min-height: 1em;
      font-weight: 800;
    }

    /* Optional: make headings feel closer to site styling */
    .panel-title,
    .details-title {
      letter-spacing: 0.01em;
    }
  </style>
</head>

<body>
<div class="page">
  <header>
    <div class="brand">
      <div class="brand-mark"></div>
      <div class="brand-text">
        <span>Estuarium Education Project</span>
        <span>Teacher Program Selector</span>
      </div>
    </div>
    <div class="header-right">
      <div class="pill">
        <span class="pill-dot"></span>
        <span>Booking window now open</span>
      </div>
      <span>Choose a program, preview cost, and submit your inquiry.</span>
    </div>
  </header>

  <main>
    <section class="programs-panel">
      <div class="panel-header">
        <div>
          <div class="panel-title">Programs at a glance</div>
          <div class="panel-subtitle">Filter by grade band or pillar and click a card to see details.</div>
        </div>
        <div class="filters">
          <div class="filter-wrapper">
            <select id="gradeFilter" class="filter-select">
              <option value="">All grade bands</option>
              <option value="PreK-2">PreK–2</option>
              <option value="3-5">Grades 3–5</option>
              <option value="6-8">Grades 6–8</option>
              <option value="8-10">Grades 8–10</option>
              <option value="10-12">Grades 10–12</option>
              <option value="Adult">Adult</option>
            </select>
          </div>
          <div class="filter-wrapper">
            <select id="pillarFilter" class="filter-select">
              <option value="">All pillars</option>
              <option value="ELI">Estuarium Learning Initiative</option>
              <option value="EAN">Estuarium Action Network</option>
            </select>
          </div>
        </div>
      </div>

      <div id="programList" class="program-list"></div>
    </section>

    <section class="details-panel">
      <div>
        <div id="detailsTitle" class="details-title">Select a program to begin</div>
        <div id="detailsSub" class="details-sub">
          Quick description, standards, and session formats will appear here.
        </div>
      </div>

      <div id="detailsTags" class="tag-row"></div>

      <div style="margin-top: 10px;">
        <div class="section-label">Program overview</div>
        <p id="detailsDescription" class="muted">
          Use the filters on the left to narrow by grade band or pillar, then click a program card.
        </p>
        <div class="session-chips" id="detailsSessions"></div>
      </div>

      <div style="margin-top: 10px;">
        <div class="section-label">Estimate your program cost</div>
        <div class="cost-grid">
          <div>
            <div class="input-group">
              <label for="inputParticipants">Number of participants</label>
              <input type="number" id="inputParticipants" min="1" value="25" />
            </div>
            <div class="input-group">
              <label for="inputHours">Program length (hours)</label>
              <input type="number" id="inputHours" min="0.5" step="0.5" value="2" />
            </div>
            <div class="input-group">
              <label for="inputFormat">Session format</label>
              <select id="inputFormat">
                <option value="field">1-day field trip</option>
                <option value="multi">Multi-week series</option>
                <option value="camp">5-day camp</option>
                <option value="virtual">Virtual / on-campus</option>
              </select>
            </div>
            <div class="error-text" id="inputError"></div>
          </div>
          <div>
            <div class="cost-summary">
              <div>
                <div class="cost-item-label">Estimated total</div>
                <!-- NOTE: kept your original JS behavior (no $ sign). Add $ in JS if desired -->
                <div id="totalCost" class="cost-main">$0.00</div>
                <div class="cost-footnote">Includes instruction and coordination.</div>
              </div>
              <div>
                <div class="cost-item-label">Per participant</div>
                <div id="perParticipant" class="cost-sub">$0.00</div>
                <div class="cost-footnote">From current group size.</div>
              </div>
            </div>
          </div>
        </div>
        <p class="cost-footnote">
          This is a working estimate; final pricing confirmed after inquiry.
        </p>
      </div>

      <div>
        <div class="section-label">Submit a program inquiry</div>
        <p class="muted">
          The form will prefill the program name you selected.
        </p>

        <div class="form-panel">
          <div class="form-panel-header">
            <span id="formProgramLabel">No program selected yet</span>
            <button type="button" onclick="openFormInNewTab()">Open in new tab</button>
          </div>
          <iframe
            id="inquiryFormFrame"
            title="Estuarium Program Inquiry"
            src="https://docs.google.com/forms/d/e/1FAIpQLSdHIjWiwmRy14Est89RnyVMbHxuHUyKDItmp3DNHAJXzRK1jQ/viewform?embedded=true">
          </iframe>
        </div>
      </div>
    </section>
  </main>
</div>

<script>
const PROGRAMS = [
  {
    id: "sound-sprouts",
    name: "Sound Sprouts",
    gradeBand: "PreK-2",
    pillar: "ELI",
    standards: "Foundational NGSS, SEL early childhood",
    sessions: ["10-week: Around the Sound with Caregiver", "4-week: Bring the Outside In"],
    formats: ["10-week", "4-week", "1-day field trip"],
    gradeLabel: "Infant–PreK with caregiver",
    shortDescription: "Playful, sensory-based estuary exploration for caregivers and young children.",
  },
  {
    id: "little-sound-scouts",
    name: "Little Sound Scouts",
    gradeBand: "PreK-2",
    pillar: "ELI",
    standards: "NGSS K-ESS2-1, K-LS1-1; SEL",
    sessions: ["10-week: Seasons Around the Sound", "4-week: Small Scientists by the Shore", "5-day camp: My Estuary Adventure", "1-day: Little Beachcombers"],
    formats: ["10-week", "4-week", "5-day camp", "1-day field trip"],
    gradeLabel: "Grades K–2",
    shortDescription: "Early elementary nature adventures focusing on observation, wonder, and estuary exploration.",
  },
  {
    id: "sound-detectives",
    name: "Sound Detectives",
    gradeBand: "3-5",
    pillar: "ELI",
    standards: "NGSS 3-LS4-3, 4-ESS2-2, 5-PS1-3",
    sessions: ["10-week: Unlocking Estuary Mysteries", "4-week: Intro to Investigation", "5-day camp: Shifting Shoreline", "1-day: Junior Investigator"],
    formats: ["10-week", "4-week", "5-day camp", "1-day field trip"],
    gradeLabel: "Grades 2–5 / 3–5 focus",
    shortDescription: "Inquiry-based field science where students collect data, map habitats, and solve estuary mysteries.",
  },
  {
    id: "eco-navigators",
    name: "Eco Navigators",
    gradeBand: "6-8",
    pillar: "ELI",
    standards: "Middle school NGSS (LS2.A, ESS3.C)",
    sessions: ["10-week: Unlocking Estuary Mysteries", "4-week: Four-Way Compass", "5-day camp: Estuary Action Lab"],
    formats: ["10-week", "4-week", "5-day camp", "1-day field trip"],
    gradeLabel: "Grades 6–8",
    shortDescription: "Middle school field program using navigation, mapping, and stewardship projects.",
  },
  {
    id: "echo-sounders",
    name: "Echo Sounders",
    gradeBand: "8-10",
    pillar: "ELI",
    standards: "MS-LS2-2, MS-LS2-5, MS-ESS3-3",
    sessions: ["10-week: Science for Belonging", "4-week: Field Science Foundations", "5-day camp: Echoes from the Shore", "1-day: Science Belongs to You"],
    formats: ["10-week", "4-week", "5-day camp", "1-day intensive"],
    gradeLabel: "Grades 8–10",
    shortDescription: "Identity-centered field science blending rigorous research with belonging and leadership.",
  },
  {
    id: "sound-quest",
    name: "SoundQuest",
    gradeBand: "8-10",
    pillar: "ELI",
    standards: "MS-LS2-1, MS-LS2-5, MS-ESS3-3",
    sessions: ["10-week: Queer Ecology in Action", "4-week: Estuary, Identity, and Action", "5-day camp: Field Science for Queer Belonging", "1-day: Estuary Identity intensive"],
    formats: ["10-week", "4-week", "5-day camp", "1-day intensive"],
    gradeLabel: "Grades 8–12 and LGBTQIA youth",
    shortDescription: "Queer-inclusive estuary program combining field science, arts, and identity-affirming leadership.",
  },
  {
    id: "sound-scholars",
    name: "Sound Scholars",
    gradeBand: "10-12",
    pillar: "ELI",
    standards: "HS-LS2-6, HS-ESS3-4, HS-ETS1-3",
    sessions: ["10-week: Leadership Through Estuary Science", "4-week: Youth Science in Action", "5-day camp: Science, Stewardship, and Story", "1-day: Lead Like a Scientist"],
    formats: ["10-week", "4-week", "5-day camp", "1-day intensive"],
    gradeLabel: "Grades 10–12",
    shortDescription: "Advanced high school field research, science communication, and youth leadership.",
  },
  {
    id: "sound-trekkers",
    name: "Sound Trekkers",
    gradeBand: "Adult",
    pillar: "EAN",
    standards: "Adult NGSS-aligned field science",
    sessions: ["10-week: Knowing the Sound, Caring for the Sound", "4-week: Estuary Essentials", "5-day: Field Science for Everyday People", "1-day: Walk the Estuary"],
    formats: ["10-week", "4-week", "5-day mini course", "1-day intensive"],
    gradeLabel: "Adults 18+",
    shortDescription: "Immersive adult field program for aspiring naturalists and community stewards.",
  },
  {
    id: "our-sound-selves",
    name: "Our Sound Selves",
    gradeBand: "Adult",
    pillar: "EAN",
    standards: "NGSS crosscutting concepts; SEL for adults",
    sessions: ["10-week: The Estuary Within", "4-week: Reflections in the Water", "5-day: Echoes of the Estuary", "1-day: The Sound Within"],
    formats: ["10-week", "4-week", "5-day mini course", "1-day workshop"],
    gradeLabel: "Adults 18+",
    shortDescription: "Reflective estuary program connecting ecological literacy with emotional wellbeing and story.",
  },
];

const COST_CONFIG = {
  baseCoordinationFee: 50,
  hourlyRatePerInstructor: 25,
  markupMultiplier: 1.8,
  formats: { field: 1.0, multi: 1.15, camp: 1.25, virtual: 0.9 },
  ratios: { "PreK-2": 6, "3-5": 8, "6-8": 10, "8-10": 10, "10-12": 12, Adult: 15, default: 12 },
};

let activeProgramId = null;

function calculateCost(program, participants, hours, formatKey) {
  const ratio = COST_CONFIG.ratios[program.gradeBand] ?? COST_CONFIG.ratios.default;
  const instructors = participants > 0 ? Math.ceil(participants / ratio) : 0;
  const staffCost = instructors * COST_CONFIG.hourlyRatePerInstructor * hours;
  const formatMult = COST_CONFIG.formats[formatKey] ?? COST_CONFIG.formats.field;
  const subtotal = staffCost + COST_CONFIG.baseCoordinationFee;
  const totalProgramCost = subtotal * COST_CONFIG.markupMultiplier * formatMult;
  const pricePerParticipant = participants > 0 ? totalProgramCost / participants : 0;
  return { totalProgramCost, pricePerParticipant };
}

function renderPrograms() {
  const gradeFilter = document.getElementById("gradeFilter").value;
  const pillarFilter = document.getElementById("pillarFilter").value;
  const listEl = document.getElementById("programList");
  listEl.innerHTML = "";

  PROGRAMS.forEach(prog => {
    if (gradeFilter && prog.gradeBand !== gradeFilter) return;
    if (pillarFilter && prog.pillar !== pillarFilter) return;

    const card = document.createElement("button");
    card.className = "program-card";
    card.type = "button";
    card.dataset.id = prog.id;
    if (activeProgramId === prog.id) card.classList.add("active");

    const est = calculateCost(prog, 25, 2, "field");

    card.innerHTML = `
      <div style="display:flex; justify-content:space-between; align-items:center; gap:6px; flex-wrap:wrap;">
        <div class="program-name">${prog.name}</div>
        <span class="badge badge-standards">${prog.standards}</span>
      </div>
      <div class="meta-row">
        <span>${prog.gradeLabel}</span>
        <span>Pillar: ${prog.pillar}</span>
      </div>
      <p class="description">${prog.shortDescription}</p>
      <div class="format-row">
        ${prog.formats.map(f => `<span class="format-pill">${f}</span>`).join("")}
      </div>
      <div class="quick-cost">
        <span>Example: 25 students · 2 hr</span>
        <span>from <strong>$${est.totalProgramCost.toFixed(0)}</strong></span>
      </div>
    `;

    card.addEventListener("click", () => setActiveProgram(prog.id));
    listEl.appendChild(card);
  });

  if (!activeProgramId && PROGRAMS.length > 0) {
    const first = listEl.querySelector(".program-card");
    if (first) setActiveProgram(first.dataset.id);
  }
}

function setActiveProgram(id) {
  const prog = PROGRAMS.find(p => p.id === id);
  if (!prog) return;
  activeProgramId = id;

  document.querySelectorAll(".program-card").forEach(c => {
    c.classList.toggle("active", c.dataset.id === id);
  });

  document.getElementById("detailsTitle").textContent = prog.name;
  document.getElementById("detailsSub").textContent = `${prog.gradeLabel} · Pillar ${prog.pillar}`;
  document.getElementById("detailsDescription").textContent = prog.shortDescription;

  const tagsEl = document.getElementById("detailsTags");
  tagsEl.innerHTML = `
    <span class="tag">Grade band: ${prog.gradeBand}</span>
    <span class="tag">${prog.standards}</span>
  `;

  const sessionsEl = document.getElementById("detailsSessions");
  sessionsEl.innerHTML = prog.sessions.map(s =>
    `<span class="session-chip"><strong>Session:</strong> ${s}</span>`
  ).join("");

  document.getElementById("formProgramLabel").textContent = `Inquiry form for: ${prog.name}`;
  updateFormPrefill();
  recalc();
}

function recalc() {
  const participants = Number(document.getElementById("inputParticipants").value);
  const hours = Number(document.getElementById("inputHours").value);
  const formatKey = document.getElementById("inputFormat").value;
  const errorEl = document.getElementById("inputError");

  errorEl.textContent = "";

  if (!activeProgramId || !participants || participants <= 0 || !hours || hours <= 0) {
    if (participants <= 0 || hours <= 0) {
      errorEl.textContent = "Enter positive numbers for participants and hours.";
    }
    document.getElementById("totalCost").textContent = "$0.00";
    document.getElementById("perParticipant").textContent = "$0.00";
    return;
  }

  const prog = PROGRAMS.find(p => p.id === activeProgramId);
  const { totalProgramCost, pricePerParticipant } = calculateCost(prog, participants, hours, formatKey);

  // Keep your current formatting behavior
  document.getElementById("totalCost").textContent = `$${totalProgramCost.toFixed(2)}`;
  document.getElementById("perParticipant").textContent = `$${pricePerParticipant.toFixed(2)}`;
}

function updateFormPrefill() {
  const baseUrl = "https://docs.google.com/forms/d/e/1FAIpQLSdHIjWiwmRy14Est89RnyVMbHxuHUyKDItmp3DNHAJXzRK1jQ/viewform";
  const prog = PROGRAMS.find(p => p.id === activeProgramId);
  const url = prog
    ? `${baseUrl}?embedded=true&entry.123456789=${encodeURIComponent(prog.name)}`
    : `${baseUrl}?embedded=true`;
  document.getElementById("inquiryFormFrame").src = url;
}

function openFormInNewTab() {
  const baseUrl = "https://docs.google.com/forms/d/e/1FAIpQLSdHIjWiwmRy14Est89RnyVMbHxuHUyKDItmp3DNHAJXzRK1jQ/viewform";
  const prog = PROGRAMS.find(p => p.id === activeProgramId);
  const url = prog
    ? `${baseUrl}?entry.123456789=${encodeURIComponent(prog.name)}`
    : baseUrl;
  window.open(url, "_blank");
}

document.getElementById("inputParticipants").addEventListener("input", recalc);
document.getElementById("inputHours").addEventListener("input", recalc);
document.getElementById("inputFormat").addEventListener("change", recalc);
document.getElementById("gradeFilter").addEventListener("change", renderPrograms);
document.getElementById("pillarFilter").addEventListener("change", renderPrograms);

renderPrograms();
</script>
</body>
</html>
